# ğŸ¨ Demo 10: è§†è§‰ç®—æ³•æ¼”ç¤º

åœ¨ WebRTC è§†é¢‘æµä¸Šå®æ—¶è¿è¡Œå¤šç§ OpenCV è§†è§‰ç®—æ³•ã€‚

---

## è¿è¡Œå¹³å°

| å¹³å° | æ”¯æŒæƒ…å†µ |
|------|----------|
| PC   | âœ… æ”¯æŒ |
| Reachy Mini | âŒ ä¸é€‚ç”¨ |

> æ­¤ demo åœ¨ PC ä¸Šè¿è¡Œï¼Œæ¥æ”¶å¹¶å¤„ç†æ¥è‡ª Reachy Mini çš„è§†é¢‘æµã€‚

---

## åŠŸèƒ½ç‰¹æ€§

### æ”¯æŒçš„è§†è§‰ç®—æ³•

| ç®—æ³• | è¯´æ˜ | ä¾èµ– |
|------|------|------|
| **äººè„¸æ£€æµ‹** | æ£€æµ‹äººè„¸å’Œçœ¼ç› (Haar Cascade) | `opencv-python` |
| **è¿åŠ¨æ£€æµ‹** | æ£€æµ‹ç”»é¢ä¸­çš„è¿åŠ¨åŒºåŸŸ | `opencv-python` |
| **è¾¹ç¼˜æ£€æµ‹** | Canny è¾¹ç¼˜æ£€æµ‹æ•ˆæœ | `opencv-python` |
| **é¢œè‰²è¿½è¸ª** | è¿½è¸ªæŒ‡å®šé¢œè‰²ï¼ˆçº¢/ç»¿/è“/é»„ï¼‰| `opencv-python` |
| **è§’ç‚¹æ£€æµ‹** | æ£€æµ‹å›¾åƒä¸­çš„è§’ç‚¹ç‰¹å¾ | `opencv-python` |

### äº¤äº’åŠŸèƒ½

- **é”®ç›˜æ§åˆ¶**: å®æ—¶åˆ‡æ¢ç®—æ³•å’Œå‚æ•°
- **FPS æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºå¸§ç‡å’Œå¤„ç†æ—¶é—´
- **ä½å»¶è¿Ÿ**: 50ms WebRTC å»¶è¿Ÿé…ç½®

---

## å‰ç½®æ¡ä»¶

### 1. ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04/22.04), macOS, Windows
- **Python**: 3.7+
- **ç½‘ç»œ**: ä¸ Reachy Mini åœ¨åŒä¸€å±€åŸŸç½‘
- **æ‘„åƒå¤´**: Reachy Mini éœ€è¦è¿è¡Œè§†é¢‘æµæœåŠ¡

### 2. GStreamer å®‰è£…

é¦–å…ˆéœ€è¦å®‰è£… GStreamer å’Œ WebRTC æ’ä»¶ï¼ˆå‚è€ƒ [Demo 05](../05_webrtc_video_stream/README.md)ï¼‰ï¼š

```bash
# Ubuntu/Debian
sudo apt-get install -y \
    libgstreamer-plugins-bad1.0-dev \
    libgstreamer-plugins-base1.0-dev \
    libgstreamer1.0-dev \
    python3-gi \
    gstreamer1.0-plugins-good \
    gstreamer1.0-plugins-bad
```

### 3. Python ä¾èµ–

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æˆ–å•ç‹¬å®‰è£…
pip install opencv-python numpy
pip install 'reachy-mini[gstreamer]'
```

---

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆæ‰€æœ‰ç®—æ³•ï¼‰
python3 10.py

# è¿æ¥åˆ°æŒ‡å®š IP çš„ Reachy Mini
python3 10.py --signaling-host 10.42.0.75

# ä»…å¯ç”¨ç‰¹å®šç®—æ³•
python3 10.py --algorithms face motion edge
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç®€å†™ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--signaling-host` | `-s` | `127.0.0.1` | ä¿¡ä»¤æœåŠ¡å™¨åœ°å€ |
| `--signaling-port` | `-p` | `8443` | ä¿¡ä»¤æœåŠ¡å™¨ç«¯å£ |
| `--peer-name` | `-n` | `reachymini` | å¯¹ç­‰ä½“åç§° |
| `--algorithms` | `-a` | æ‰€æœ‰ç®—æ³• | å¯ç”¨çš„ç®—æ³•åˆ—è¡¨ |

### å¯ç”¨ç®—æ³•

- `face` - äººè„¸æ£€æµ‹
- `motion` - è¿åŠ¨æ£€æµ‹
- `edge` - è¾¹ç¼˜æ£€æµ‹
- `color` - é¢œè‰²è¿½è¸ª
- `corner` - è§’ç‚¹æ£€æµ‹

---

## é”®ç›˜æ§åˆ¶

è¿è¡Œåå¯ä½¿ç”¨ä»¥ä¸‹é”®ç›˜æ§åˆ¶ï¼š

| æŒ‰é”® | åŠŸèƒ½ |
|------|------|
| `1-5` | åˆ‡æ¢è§†è§‰ç®—æ³• |
| `SPACE` | å¼€/å…³å½“å‰ç®—æ³• |
| `Q` / `ESC` | é€€å‡ºç¨‹åº |

---

## ç®—æ³•æ•ˆæœ

### äººè„¸æ£€æµ‹

æ£€æµ‹äººè„¸å¹¶ç”¨è“è‰²æ–¹æ¡†æ ‡è®°ï¼ŒåŒæ—¶æ£€æµ‹çœ¼ç›ç”¨ç»¿è‰²æ–¹æ¡†æ ‡è®°ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Faces: 2                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ o o â”‚   â”‚ o o â”‚              â”‚
â”‚  â”‚  âˆª  â”‚   â”‚  âˆª  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                 â”‚
â”‚  FPS: 28 | Process: 8.5ms      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿åŠ¨æ£€æµ‹

æ£€æµ‹ç”»é¢ä¸­çš„è¿åŠ¨åŒºåŸŸå¹¶ç”¨ç»¿è‰²æ–¹æ¡†æ ‡è®°ï¼Œè®¡æ•°è¿åŠ¨äº‹ä»¶ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Status: MOTION!                â”‚
â”‚  Events: 15                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚            â”‚                 â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”   â”‚                 â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”˜   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                 â”‚
â”‚  FPS: 30 | Process: 3.2ms      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¾¹ç¼˜æ£€æµ‹

ä½¿ç”¨ Canny ç®—å­è¿›è¡Œè¾¹ç¼˜æ£€æµ‹ï¼Œä¸åŸå§‹å›¾åƒ 50% æ··åˆæ˜¾ç¤ºã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚     â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®        â”‚
â”‚     â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚        â”‚
â”‚     â”‚  â•‘            â•‘  â”‚        â”‚
â”‚     â”‚  â•‘    â–²â–²â–²     â•‘  â”‚        â”‚
â”‚     â”‚  â•‘    â–²â–²â–²     â•‘  â”‚        â”‚
â”‚     â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚        â”‚
â”‚     â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯        â”‚
â”‚                                 â”‚
â”‚  FPS: 30 | Process: 2.1ms      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¢œè‰²è¿½è¸ª

è¿½è¸ªæŒ‡å®šé¢œè‰²ï¼ˆé»˜è®¤çº¢è‰²ï¼‰çš„æœ€å¤§åŒºåŸŸï¼Œç”¨åœ†åœˆæ ‡è®°ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tracking: RED                  â”‚
â”‚                                 â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚        â”‚              â”‚
â”‚         â”‚   â—    â”‚              â”‚
â”‚         â”‚        â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                 â”‚
â”‚  FPS: 30 | Process: 4.8ms      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è§’ç‚¹æ£€æµ‹

ä½¿ç”¨ goodFeaturesToTrack æ£€æµ‹å›¾åƒä¸­çš„è§’ç‚¹ç‰¹å¾ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Corners: 45                    â”‚
â”‚                                 â”‚
â”‚     â€¢   â€¢       â€¢   â€¢           â”‚
â”‚   â€¢   â€¢       â€¢   â€¢   â€¢         â”‚
â”‚     â€¢       â€¢   â€¢   â€¢           â”‚
â”‚           â€¢   â€¢       â€¢         â”‚
â”‚     â€¢   â€¢       â€¢   â€¢           â”‚
â”‚                                 â”‚
â”‚  FPS: 30 | Process: 5.2ms      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         WebRTC         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Reachy Mini    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   Vision Processor     â”‚
â”‚  (Camera)       â”‚      Video Stream      â”‚                         â”‚
â”‚                 â”‚                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                        â”‚  â”‚  webrtcsrc      â”‚    â”‚
â”‚  â”‚  640x480  â”‚  â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚  30 FPS   â”‚  â”‚                        â”‚           â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                        â”‚           â–¼             â”‚
â”‚                 â”‚                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚ videoconvert    â”‚    â”‚
                                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                           â”‚           â”‚             â”‚
                                           â”‚           â–¼             â”‚
                                           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                                           â”‚  â”‚  appsink        â”‚    â”‚
                                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                           â”‚           â”‚             â”‚
                                           â”‚           â–¼             â”‚
                                           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                                           â”‚  â”‚  OpenCV         â”‚    â”‚
                                           â”‚  â”‚  + Algorithm    â”‚    â”‚
                                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                           â”‚           â”‚             â”‚
                                           â”‚           â–¼             â”‚
                                           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                                           â”‚  â”‚  imshow Window  â”‚    â”‚
                                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. **è§†é¢‘æ¥æ”¶**: é€šè¿‡ WebRTC æ¥æ”¶ Reachy Mini çš„è§†é¢‘æµ
2. **æ ¼å¼è½¬æ¢**: `videoconvert` è½¬æ¢ä¸º RGB æ ¼å¼
3. **å¸§æå–**: `appsink` æå–è§†é¢‘å¸§
4. **ç®—æ³•å¤„ç†**: åº”ç”¨é€‰å®šçš„ OpenCV è§†è§‰ç®—æ³•
5. **ç»“æœå±•ç¤º**: åœ¨ OpenCV çª—å£ä¸­æ˜¾ç¤ºå¤„ç†ç»“æœ

---

## æ•…éšœæ’é™¤

### é—®é¢˜ 1: `ImportError: No module named 'cv2'`

**åŸå› **: æœªå®‰è£… OpenCV

**è§£å†³**:
```bash
pip install opencv-python numpy
```

### é—®é¢˜ 2: è¿æ¥è¶…æ—¶

**åŸå› **: æ— æ³•è¿æ¥åˆ° Reachy Mini

**è§£å†³**:
- æ£€æŸ¥ Reachy Mini æ˜¯å¦è¿è¡Œè§†é¢‘æµæœåŠ¡
- ç¡®è®¤ IP åœ°å€æ­£ç¡®
- æ£€æŸ¥ç½‘ç»œè¿æ¥

### é—®é¢˜ 3: çª—å£æ˜¾ç¤ºé»‘å±

**åŸå› **: è§†é¢‘æµæœªæ­£å¸¸æ¥æ”¶

**è§£å†³**:
- ç¡®è®¤ Reachy Mini çš„æ‘„åƒå¤´æ­£å¸¸å·¥ä½œ
- æ£€æŸ¥ GStreamer WebRTC æ’ä»¶æ˜¯å¦æ­£ç¡®å®‰è£…
- æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 4: FPS è¿‡ä½

**åŸå› **: ç®—æ³•å¤„ç†é€Ÿåº¦æ…¢

**è§£å†³**:
- å‡å°‘å¯ç”¨çš„ç®—æ³•æ•°é‡
- ä½¿ç”¨æ›´è½»é‡çš„ç®—æ³•ï¼ˆå¦‚ä»…ä½¿ç”¨è¾¹ç¼˜æ£€æµ‹ï¼‰
- é™ä½è§†é¢‘åˆ†è¾¨ç‡

---

## æ€§èƒ½å‚è€ƒ

| ç®—æ³• | å¹³å‡å¤„ç†æ—¶é—´ | æ¨è CPU |
|------|-------------|----------|
| è¾¹ç¼˜æ£€æµ‹ | ~2ms | ä»»æ„ |
| è¿åŠ¨æ£€æµ‹ | ~3ms | ä»»æ„ |
| è§’ç‚¹æ£€æµ‹ | ~5ms | ä»»æ„ |
| é¢œè‰²è¿½è¸ª | ~5ms | ä»»æ„ |
| äººè„¸æ£€æµ‹ | ~8ms | åŒæ ¸+ |

> æµ‹è¯•ç¯å¢ƒ: Ubuntu 22.04, Intel i5-1135G7, 640x480@30fps

---

## æ‰©å±•å¼€å‘

### æ·»åŠ è‡ªå®šä¹‰ç®—æ³•

ç»§æ‰¿ `VisionAlgorithm` åŸºç±»ï¼š

```python
class MyAlgorithm(VisionAlgorithm):
    def __init__(self):
        super().__init__("æˆ‘çš„ç®—æ³•")

    def process(self, frame: np.ndarray) -> tuple[np.ndarray, dict]:
        # å¤„ç†å¸§
        result = frame.copy()
        # ... ä½ çš„å¤„ç†é€»è¾‘ ...
        return result, {"data": "æ£€æµ‹ç»“æœ"}
```

### é›†æˆåˆ°ä¸»ç¨‹åº

åœ¨ `main()` å‡½æ•°ä¸­æ·»åŠ ï¼š

```python
if "my-algo" in args.algorithms:
    algorithms.append(MyAlgorithm())
```

---

## ç›¸å…³æ–‡æ¡£

- [Demo 05: WebRTC è§†é¢‘æµæ¥æ”¶](../05_webrtc_video_stream/README.md)
- [GStreamer å®‰è£…æŒ‡å—](../../docs/GSTREAMER_CN.md)
- [API å‚è€ƒæ–‡æ¡£](../../docs/API_REFERENCE_CN.md)

---

## æŠ€æœ¯ç»†èŠ‚

### è§†é¢‘æµå‚æ•°

- **ç¼–ç **: H.264
- **åˆ†è¾¨ç‡**: 640x480
- **å¸§ç‡**: 30 FPS
- **å»¶è¿Ÿ**: ~50ms

### ç®—æ³•æ¨¡å‹

| ç®—æ³• | æ¨¡å‹æ¥æº |
|------|---------|
| äººè„¸æ£€æµ‹ | Haar Cascade (OpenCV å†…ç½®) |
| è¿åŠ¨æ£€æµ‹ | å¸§å·®æ³• |
| è¾¹ç¼˜æ£€æµ‹ | Canny ç®—å­ |
| é¢œè‰²è¿½è¸ª | HSV è‰²å½©ç©ºé—´ |
| è§’ç‚¹æ£€æµ‹ | goodFeaturesToTrack |

---

## è®¸å¯è¯

MIT License
